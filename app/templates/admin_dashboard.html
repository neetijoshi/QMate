<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QMate Admin Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root {
  --primary:#4d69a5;
  --accent:#ecd386;
  --bg:#eae6dd;
  --sidebar-bg:#fff;
  --text:#333;
}

body {
  margin:0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: var(--bg);
}

/* NAVBAR */
.navbar {
  background-color: white;
  padding: 16px 40px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom:1px solid #ddd;
}
.navbar h1 {
  color: var(--primary);
  margin: 0;
  font-size: 1.6rem;
}
.nav-buttons button {
  border: 1px solid var(--primary);
  border-radius: 20px;
  padding: 6px 16px;
  background: white;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.3s;
}
.nav-buttons button.active {
  background: var(--primary);
  color: white;
}

/* LAYOUT */
.dashboard-container {
  display: flex;
  padding: 40px;
  gap: 30px;
}

/* SIDEBAR */
.sidebar {
  width: 240px;
  background-color: var(--sidebar-bg);
  border-radius: 16px;
  padding: 20px;
  height: fit-content;
}
.sidebar button {
  width: 100%;
  text-align: left;
  padding: 12px 10px;
  background: none;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
  color: var(--text);
  transition: all 0.2s ease;
}
.sidebar button:hover {
  background-color: #f3f3f3;
}
.sidebar button.active {
  background-color: var(--primary);
  color: white !important;
}
.logout {
  margin-top: 20px;
}
.logout button {
  width: 100%;
  padding: 10px;
  background-color: var(--accent);
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s;
}
.logout button:hover {
  background-color: #e3c975;
}

/* MAIN CONTENT */
.main-content {
  flex: 1;
  background-color: white;
  border-radius: 16px;
  padding: 40px;
}
.page {
  display: none;
}
.page.active {
  display: block;
}
h2 {
  color: var(--primary);
  margin-top: 0;
}

/* DASHBOARD CARDS */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 20px;
  margin-top: 20px;
}
.card {
  background: #fff;
  border: 1px solid #ddd;
  padding: 18px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 2px 5px rgba(0,0,0,0.08);
}
.card h4 { 
  color: var(--primary);
  margin-bottom: 8px;
}
.card .value {
  font-size: 20px;
  font-weight: 600;
}

/* TABLES */
.queue-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
.queue-table th, .queue-table td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}
.queue-table th {
  background-color: var(--primary);
  color: white;
}
.action-btn {
  background-color: var(--accent);
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
}
.action-btn:hover {
  background-color: #e1c973;
}
/* OPTIMIZATION FORM */
.optimization-card {
  max-width: 480px;
  background: #f9f9f9;
  padding: 28px;
  border-radius: 14px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  margin-top: 20px;
}

.optimization-card label {
  font-weight: 600;
  color: var(--primary);
  display: block;
  margin-bottom: 6px;
}

.optimization-card input {
  width: 100%;
  padding: 12px 14px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 14px;
  margin-bottom: 18px;
  transition: all 0.2s ease;
}

.optimization-card input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(77,105,165,0.2);
}

.optimization-card .action-btn {
  width: 100%;
  padding: 12px;
  font-size: 15px;
  font-weight: 600;
  border-radius: 10px;
}

#optMsg {
  margin-top: 12px;
  font-weight: 500;
}
.optimization-card select {
  width: 100%;
  padding: 12px 14px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 14px;
  margin-bottom: 18px;
  background: white;
}
.toast {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #4d69a5;
  color: white;
  padding: 14px 18px;
  border-radius: 10px;
  font-weight: 500;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  opacity: 0;
  pointer-events: none;
  transform: translateY(-10px);
  transition: all 0.3s ease;
  z-index: 9999;
}

.toast.show {
  opacity: 1;
  transform: translateY(0);
}


</style>
</head>

<body>

<!-- NAVBAR -->
<div class="navbar">
  <h1>QMate</h1>
  <div class="nav-buttons">
    <button onclick="window.location.href='/'">User</button>
    <button class="active">Admin</button>
  </div>
</div>

<!-- DASHBOARD BODY -->
<div class="dashboard-container">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <button class="active" onclick="switchPage(event, 'dashboard')"><i class="fa-solid fa-chart-line"></i> Dashboard</button>
    <button onclick="switchPage(event, 'manage')"><i class="fa-solid fa-gears"></i> Manage Queues</button>
    <button onclick="switchPage(event, 'optimization')"><i class="fa-solid fa-gauge-high"></i> Optimization</button>
    <button onclick="switchPage(event, 'reports')"><i class="fa-solid fa-file-lines"></i> Reports</button>
    <div class="logout">
      <button onclick="window.location.href='/logout'"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
          <div style="
  margin-top:40px;
  font-size:12px;
  color:#999;
  text-align:center;
">
  ¬© 2026 QMate.
</div>
    </div>
  </div>

  <!-- MAIN PANEL -->
  <div class="main-content">

    <!-- DASHBOARD PAGE -->
   <!-- DASHBOARD PAGE -->
<div id="dashboard" class="page active">

  <h2>Dashboard</h2>

  <!-- QUEUE VISUAL BLOCK -->
  <h3 style="margin-top:20px;color:#4d69a5;">Queues Overview</h3>
  <div id="queueVisual"
       style="display:flex;gap:20px;flex-wrap:wrap;margin-bottom:30px;">
  </div>

  <!-- KPI CARDS -->
  <div class="cards">
    <div class="card">
      <h4>Active Queues</h4>
      <div class="value" id="dQueues">0</div>
    </div>

    <div class="card">
      <h4>Total Waiting</h4>
      <div class="value" id="dWaiting">0</div>
    </div>

    <div class="card">
      <h4>Avg Wait Time</h4>
      <div class="value" id="dAvg">0 min</div>
    </div>

    <div class="card">
      <h4>Efficiency</h4>
      <div class="value" id="dEff">0%</div>
    </div>
  </div>

</div>

    <!-- MANAGE QUEUES -->
    <div id="manage" class="page">
  <h2>Manage Queues</h2>
  <p>Click a queue name to view its tokens</p>

  <table class="queue-table">
    <thead>
      <tr>
        <th>Queue Name</th>
        <th>Customers Waiting</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="queueTableBody"></tbody>
  </table>

  <div id="queueError" style="margin-top:15px;color:#c0392b;display:none"></div>

  <!-- ‚úÖ TOKEN TABLE (INSIDE MANAGE PAGE) -->
  <h3 style="margin-top:30px;color:#4d69a5;">Queue Tokens</h3>
  <table class="queue-table" id="tokenTable" style="display:none;">
    <thead>
      <tr>
        <th>Token</th>
        <th>User</th>
        <th>Email</th>
        <th>Status</th>
        <th>Joined</th>
        <th>Scheduled</th>
        <th>Paused Till</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="tokenTableBody"></tbody>
  </table>
</div>


    <!-- OPTIMIZATION -->
  <div id="optimization" class="page">
  <h2>Queue Optimization</h2>

  <div class="optimization-card">

    <label>Select Service</label>
    <select id="queueSelect" required>
      <option value="" disabled selected>-- Choose a Service --</option>
    </select>

    <label>Total Counters</label>
    <input type="number" id="counterCount"
           placeholder="Enter total counters (e.g. 3)">

    <label>Counter Service Times (minutes)</label>
    <p style="font-size: 13px; color: #666;">
      Enter comma-separated values (example: 5,3,2)
    </p>
    <input type="text" id="serviceTimes"
           placeholder="Example: 5,3,2  (Counter 1 ‚Üí 5 min)">

    <button onclick="saveOptimization()" class="action-btn">
      Save Optimization
    </button>

    <p id="optMsg"></p>

  </div>
</div>
    <!-- REPORTS -->
    <div id="reports" class="page">
  <h2>Queue Performance Reports</h2>
  <label style="font-weight:600;color:#4d69a5">
  Select Queue
</label>

<select id="reportQueueSelect"
        style="margin-bottom:20px;padding:10px;border-radius:8px">
</select>

  <div class="cards">
    <div class="card">
      <h4>Total Tokens</h4>
      <div class="value" id="rTotal">0</div>
    </div>
    <!-- <div class="card">
  <h4>Served Tokens</h4>
  <div class="value" id="rServed">0</div>
</div> -->

    <div class="card">
      <h4>Avg Wait (min)</h4>
      <div class="value" id="rAvg">0</div>
    </div>
    <div class="card">
      <h4>Efficiency</h4>
      <div class="value" id="rEff">0%</div>
    </div>
  </div>
  <!-- QUEUE-WISE SECTION (ONLY FOR ALL QUEUES) -->
<div id="queueWiseSection">

  <h3 style="margin-top:40px">Queue-wise Report</h3>

  <table class="queue-table">
    <thead>
      <tr>
        <th>Queue</th>
        <th>Total Tokens</th>
        <th>Served</th>
        <th>Waiting</th>
        <th>Efficiency</th>
      </tr>
    </thead>
    <tbody id="queueReportBody"></tbody>
  </table>

  <h3 style="margin-top:40px">Queue-wise Efficiency</h3>
  <canvas id="queueEfficiencyChart" height="120"></canvas>

</div>
<!-- END QUEUE-WISE SECTION -->

  <h3 style="margin-top:30px">Hourly Load</h3>
  <table class="queue-table">
    <thead>
      <tr>
        <th>Hour</th>
        <th>Tokens</th>
      </tr>
    </thead>
    <tbody id="hourlyTable"></tbody>
  </table>
  <h3 style="margin-top:40px">Hourly Token Load</h3>
<canvas id="hourlyChart" height="100" ></canvas>

<h3 style="margin-top:40px">
  Token Status Distribution
</h3>

<div style="
  display:flex;
  justify-content:center;
  align-items:center;
  width:100%;
">
  <div style="width:500px; height:500px;">
    <canvas id="statusChart"></canvas>
  </div>
</div>


</div>

  </div>
</div>
<div id="toast" class="toast"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let reportInterval = null;
</script>
<script>
function switchPage(event, pageName) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(pageName).classList.add('active');

  document.querySelectorAll('.sidebar button').forEach(btn => btn.classList.remove('active'));
  event.currentTarget.classList.add('active');

  if (pageName === "reports") {
  loadReportQueues();

  // üîÅ start real-time refresh
  if (reportInterval) clearInterval(reportInterval);

  reportInterval = setInterval(() => {
    handleReportChange();
  }, 5000);
} else {
  // ‚õî stop when leaving reports
  if (reportInterval) {
    clearInterval(reportInterval);
    reportInterval = null;
  }
}

}
function drawHourlyChart(hourly) {
  const tbody = document.getElementById("hourlyTable");
  tbody.innerHTML = "";

  if (hourlyChart) {
    hourlyChart.destroy();
    hourlyChart = null;
  }

  if (!hourly || hourly.length === 0) {
    tbody.innerHTML = "<tr><td colspan='2'>No data</td></tr>";
    return;
  }

  const labels = [];
  const values = [];

  hourly.forEach(h => {
    labels.push(formatHour(h.hour));
    values.push(h.count);

    tbody.innerHTML += `
      <tr>
        <td>${formatHour(h.hour)}</td>
        <td>${h.count}</td>
      </tr>
    `;
  });

  hourlyChart = new Chart(
    document.getElementById("hourlyChart"),
    {
      type: "bar",
      data: {
        labels,
        datasets: [{
          label: "Tokens per Hour",
          data: values
        }]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true } }
      }
    }
  );
}

function drawStatusChart(data) {
  if (statusChart) {
    statusChart.destroy();
    statusChart = null;
  }

  const served = data.served_tokens || 0;
  const active = data.active_tokens || 0;
  const scheduled = data.scheduled_tokens || 0;
  const cancelled = data.cancelled_tokens || 0;

  statusChart = new Chart(
    document.getElementById("statusChart"),
    {
      type: "pie",
      data: {
        labels: ["Served", "Active", "Scheduled", "Cancelled"],
        datasets: [{
          data: [served, active, scheduled, cancelled]
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: "right" }
        }
      }
    }
  );
}


</script>
<script>
function loadQueues() {
  fetch("/admin/queue_status")
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("queueTableBody");
      const errorDiv = document.getElementById("queueError");

      tbody.innerHTML = "";            // clear old rows
      errorDiv.style.display = "none"; // hide error

      if (data.length === 0) {
        errorDiv.innerText = "No queues available.";
        errorDiv.style.display = "block";
        return;
      }

      data.forEach(q => {
        const row = `
          <tr>
            <td style="cursor:pointer;color:#4d69a5;font-weight:600"
    onclick="loadQueueTokens(${q.id})">
  ${q.name}
</td>

            <td>${q.waiting}</td>
            <td>${q.status}</td>
            <td>
  <button class="action-btn" onclick="pauseQueue(${q.id})">
    Pause
  </button>
  <button class="action-btn" onclick="serveNext(${q.id})">
    Next
  </button>
</td>

          </tr>
        `;
        tbody.innerHTML += row;
      });
    })
    .catch(() => {
      const errorDiv = document.getElementById("queueError");
      errorDiv.innerText = "Failed to load queues.";
      errorDiv.style.display = "block";
    });
}

// auto refresh
setInterval(loadQueues, 3000);
loadQueues();


</script>

<script>
function serveNext(queueId) {
  fetch("/admin/next_token", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ queue_id: queueId })
  })
  .then(res => res.json())

  .then(data => {
    if (data.message === "No active tokens") {
    showToast("No active token in this queue");
  } else {
    showToast(`Token number ${data.token_number} served`);
    loadQueues();
  }
})

  .catch(() => {
    const errorDiv = document.getElementById("queueError");
    errorDiv.innerText = "Server error. Try again.";
    errorDiv.style.display = "block";
  });
}
</script>

<!-- <script>
function saveSettings() {
  fetch("/admin/set_queue_settings", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      queue_id: Number(document.getElementById("queueId").value),
      avg_service_time: Number(document.getElementById("serviceTime").value),
      counters: Number(document.getElementById("counters").value)
    })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById("optMsg").innerText =
      data.error ? data.error : data.message;
  });
}

</script> -->

<script>
function loadAdminServices() {
  fetch("/admin/my_services")
    .then(res => res.json())
    .then(data => {
      const select = document.getElementById("queueSelect");

      // reset
      select.innerHTML =
        `<option value="" disabled selected>-- Choose a Service --</option>`;

      if (data.length === 0) {
        const opt = document.createElement("option");
        opt.text = "No services assigned";
        opt.disabled = true;
        select.appendChild(opt);
        return;
      }

      data.forEach(service => {
        const opt = document.createElement("option");
        opt.value = service.id;
        opt.text = service.name;
        select.appendChild(opt);
      });
    });
}

// load when page opens
loadAdminServices();
</script>
<script>
function saveOptimization() {
  const queueSelect = document.getElementById("queueSelect");
  const counterCount = Number(document.getElementById("counterCount").value);
  const serviceTimesRaw = document.getElementById("serviceTimes").value;

  const optMsg = document.getElementById("optMsg");

  if (!queueSelect.value) {
    optMsg.innerText = "Please select a service";
    return;
  }

  if (!counterCount || counterCount <= 0) {
    optMsg.innerText = "Enter a valid counter count";
    return;
  }

  const serviceTimes = serviceTimesRaw
    .split(",")
    .map(x => Number(x.trim()))
    .filter(x => !isNaN(x));

  if (serviceTimes.length !== counterCount) {
    optMsg.innerText =
      "Service times count must match total counters";
    return;
  }

  fetch("/admin/set_queue_settings", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      queue_id: Number(queueSelect.value),
      counters: counterCount,
      service_times: serviceTimes
    })
  })
  .then(async res => {
  const data = await res.json();
  if (!res.ok) throw data;
  return data;
})
.then(data => {
  optMsg.innerText = data.message;
})
.catch(err => {
  optMsg.innerText = err.error || "Server error";
});

}
</script>
<script>
function loadQueueTokens(queueId) {
  fetch(`/admin/queue_tokens/${queueId}`)
    .then(res => res.json())
    .then(tokens => {
      const table = document.getElementById("tokenTable");
      const tbody = document.getElementById("tokenTableBody");

      tbody.innerHTML = "";
      table.style.display = "table";

      if (tokens.length === 0) {
        tbody.innerHTML = `
          <tr><td colspan="8">No tokens in this queue</td></tr>
        `;
        return;
      }

      tokens.forEach(t => {
        tbody.innerHTML += `
          <tr>
            <td>${t.token_number}</td>
            <td>${t.user_name}</td>
            <td>${t.email}</td>
            <td>${t.status}</td>
            <td>${t.joined_at}</td>
            <td>${t.scheduled_time || "-"}</td>
            <td>${t.postponed_until || "-"}</td>
            <td>
              ${actionButtons(t)}
            </td>
          </tr>
        `;
      });
    });
}

function actionButtons(t) {
  let btns = "";

  if (t.status === "ACTIVE") {
  btns += `<button class="action-btn"
    onclick="adminRemove(${t.token_id}, '${t.user_name}')">
    Remove
  </button>`;
}


  if (t.status === "PAUSED") {
  btns += `<button class="action-btn"
    onclick="adminResume(${t.token_id}, '${t.user_name}')">
    Resume
  </button>`;
}


  return btns || "-";
}
</script>
<script>
function adminRemove(tokenId, userName) {
  fetch("/admin/remove_token", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ token_id: tokenId })
  })
  .then(() => {
    showToast(`${userName} has been removed from the queue`);
    loadQueues();
  });
}


function adminResume(tokenId, userName) {
  fetch("/admin/resume_token", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ token_id: tokenId })
  })
  .then(() => {
    showToast(`${userName} is added back in the queue`);
    loadQueues();
  });
}

</script>
<script>
function formatHour(hour) {
  const h = Number(hour);
  const suffix = h >= 12 ? "PM" : "AM";
  const hour12 = ((h + 11) % 12) + 1;
  return `${hour12}:00 ${suffix}`;
}


</script>
<script>
function loadDashboardStats() {
  fetch("/admin/dashboard_stats")
    .then(res => res.json())
    .then(data => {
      document.getElementById("dQueues").innerText = data.active_queues;
      document.getElementById("dWaiting").innerText = data.waiting_tokens;
      document.getElementById("dAvg").innerText = data.avg_wait + " min";
      document.getElementById("dEff").innerText = data.efficiency + "%";
    });
}

// Load once when page opens
loadDashboardStats();

// üîÅ Auto refresh every 5 seconds
setInterval(loadDashboardStats, 5000);
</script>
<script>
function showToast(message) {
  const toast = document.getElementById("toast");
  toast.innerText = message;
  toast.classList.add("show");

  setTimeout(() => {
    toast.classList.remove("show");
  }, 3000);
}
</script>
<script>
function pauseQueue(queueId) {
  fetch("/admin/pause_queue", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ queue_id: queueId })
  })
  .then(res => res.json())
  .then(data => {
    showToast(data.message || "Queue paused");
    loadQueues();
  })
  .catch(() => {
    showToast("Failed to pause queue");
  });
}
</script>
<script>
function loadQueueVisual() {
  fetch("/admin/queue_status")
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById("queueVisual");
      container.innerHTML = "";

      data.forEach(q => {
        let people = "";
        for (let i = 0; i < q.waiting; i++) {
          people += `
            <div style="
              width:22px;
              height:22px;
              background:#4d69a5;
              border-radius:6px;
            "></div>
          `;
        }

        container.innerHTML += `
          <div style="
            background:#fff;
            padding:16px;
            border-radius:12px;
            width:220px;
            box-shadow:0 4px 10px rgba(0,0,0,0.1)
          ">
            <h4 style="margin:0;color:#4d69a5">${q.name}</h4>
            <p style="font-size:13px;color:#666">Waiting: ${q.waiting}</p>
            <div style="display:flex;gap:6px;flex-wrap:wrap">
              ${people || "<span style='color:#999'>No waiting</span>"}
            </div>
          </div>
        `;
      });
    });
}

loadQueueVisual();
setInterval(loadQueueVisual, 5000);
</script>
<script>
function loadQueueReports() {
  fetch("/admin/reports/queues")
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("queueReportBody");
      tbody.innerHTML = "";

      if (!data || data.length === 0) {
        tbody.innerHTML =
          "<tr><td colspan='5'>No report data available</td></tr>";
        return;
      }

      data.forEach(q => {
        tbody.innerHTML += `
          <tr>
            <td>${q.queue}</td>
            <td>${q.total}</td>
            <td>${q.served}</td>
            <td>${q.waiting}</td>
            <td>${q.efficiency}%</td>
          </tr>
        `;
      });

      drawQueueEfficiencyChart(data);
    })
    .catch(err => {
      console.error(err);
    });
}
</script>
<script>
let queueEffChart;

function drawQueueEfficiencyChart(data) {
  const labels = data.map(q => q.queue);
  const values = data.map(q => q.efficiency);

  if (queueEffChart) queueEffChart.destroy();

  queueEffChart = new Chart(
    document.getElementById("queueEfficiencyChart"),
    {
      type: "bar",
      data: {
        labels,
        datasets: [{
          label: "Efficiency (%)",
          data: values
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true, max: 100 }
        }
      }
    }
  );
}
</script>

<script>
let hourlyChart = null;
let statusChart = null;

/* ================= DROPDOWN ================= */
function loadReportQueues() {
  fetch("/admin/my_services")
    .then(res => res.json())
    .then(data => {
      const select = document.getElementById("reportQueueSelect");
      select.innerHTML = `<option value="all">All Queues</option>`;

      data.forEach(q => {
        const opt = document.createElement("option");
        opt.value = q.id;
        opt.text = q.name;
        select.appendChild(opt);
      });

      select.onchange = handleReportChange;

      handleReportChange(); // initial load
    });
}

function handleReportChange() {
  const queueId = document.getElementById("reportQueueSelect").value;

  if (queueId === "all") {
    loadGlobalReport();
  } else {
    loadSingleQueueReport(queueId);
  }
}


/* ================= GLOBAL ================= */
function loadGlobalReport() {
  document.getElementById("queueWiseSection").style.display = "block";

  fetch("/admin/reports")
    .then(res => res.json())
    .then(data => {
      // üü¶ CARDS
      document.getElementById("rTotal").innerText = data.total_tokens;
      document.getElementById("rAvg").innerText = data.avg_wait + " min";
      document.getElementById("rEff").innerText = data.efficiency + "%";

      // üü¶ CHARTS
      drawHourlyChart(data.hourly);
      drawStatusChart(data);

      // üü¶ TABLE + BAR
      loadQueueReports();
    });
}


/* ================= SINGLE QUEUE ================= */
function loadSingleQueueReport(queueId) {
  document.getElementById("queueWiseSection").style.display = "none";

  fetch(`/admin/reports/queue/${queueId}`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("rTotal").innerText = data.total_tokens;
      document.getElementById("rAvg").innerText = data.avg_wait + " min";
      document.getElementById("rEff").innerText = data.efficiency + "%";

      drawHourlyChart(data.hourly);
      drawStatusChart(data);
    });
}

</script>

</body>
</html>
